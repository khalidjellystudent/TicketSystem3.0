@model List<TicketSystem.Models.Ticket>
@{
    Layout = "_OfficeLayout";
    ViewData["Title"] = "Tickets Under Process";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">@ViewData["Title"]</h1>
        <p class="text-muted mb-0">Manage and review tickets currently being processed</p>
    </div>
    <div>
        <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2">
            <i class="bi bi-list-check me-1"></i>
            @Model.Count @(Model.Count == 1 ? "Ticket" : "Tickets")
        </span>
    </div>
</div>

<hr class="mt-0 mb-4" />

<!-- Desktop Table (md and up) -->
@if (!Model.Any())
{
    <div class="alert alert-info d-none d-md-block">
        <i class="bi bi-info-circle-fill me-2"></i>
        There are currently no tickets under process.
    </div>
}
else
{
    <div class="table-responsive d-none d-md-block mb-4">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Plate</th>
                    <th scope="col">Location</th>
                    <th scope="col">Issued By</th>
                    <th scope="col">Date</th>
                    <th scope="col">Due</th>
                    <th scope="col">Fine</th>
                    <th scope="col">Status</th>
                    @* <th scope="col" class="text-end">Actions</th> *@
                </tr>
            </thead>
            <tbody>
                @foreach (var ticket in Model)
                {
                    <tr class="ticket-row" data-href="@Url.Action("DetailedTicket", new { id = ticket.Ticket_Id })">
                        <td>@ticket.Ticket_Id</td>
                        <td>@ticket.Plate_Number</td>
                        <td>@ticket.Violation_Place</td>
                        <td>@ticket.IssuedBy</td>
                        <td>@ticket.Ticket_Time.ToString("MMM d, yyyy")</td>
                        <td>@ticket.Due_Date.ToString("MMM d, yyyy")</td>
                        <td class="fw-medium">@ticket.FineAmount.ToString("C")</td>
                        <td><span class="badge @GetStatusBadgeClass(ticket.Status)">@ticket.Status</span></td>
                        @* <td class="text-end">
                            <a asp-action="DetailedTicket" asp-route-id="@ticket.Ticket_Id" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-arrow-right"></i> Detailes
                            </a>
                        </td> *@
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<!-- Mobile Cards (sm and down) -->
<div class="d-block d-md-none">
    @if (!Model.Any())
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle-fill me-2"></i>
            There are no tickets under process.
        </div>
    }
    else
    {
        <div class="row g-3">
            @foreach (var ticket in Model)
            {
                <div class="col-12">
                    <div class="card shadow-sm border-0 mb-3">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5 class="card-title mb-1 fw-bold">
                                        <i class="bi bi-ticket-detailed text-primary me-2"></i>
                                        Ticket #@ticket.Ticket_Id
                                    </h5>
                                    <div class="d-flex align-items-center text-muted mb-2">
                                        <i class="bi bi-car-front me-2"></i>
                                        <span>@ticket.Plate_Number</span>
                                    </div>
                                </div>
                                <span class="badge @GetStatusBadgeClass(ticket.Status)">
                                    @ticket.Status
                                </span>
                            </div>

                            <div class="bg-light p-3 rounded-2 mb-3">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <div class="text-muted small">Issued</div>
                                        <div class="fw-medium">
                                            <i class="bi bi-calendar3 me-1"></i>
                                            @ticket.Ticket_Time.ToString("MMM d, yyyy")
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="text-muted small">Due Date</div>
                                        <div class="fw-medium">
                                            <i class="bi bi-calendar-check me-1"></i>
                                            @ticket.Due_Date.ToString("MMM d, yyyy")
                                        </div>
                                    </div>
                                    <div class="col-12 mt-2">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="text-muted small">Fine Amount</div>
                                                <div class="h5 mb-0 text-primary fw-bold">
                                                    @ticket.FineAmount.ToString("C")
                                                </div>
                                            </div>
                                            <a asp-action="DetailedTicket" asp-route-id="@ticket.Ticket_Id"
                                               class="btn btn-primary btn-sm">
                                                <i class="bi bi-arrow-right me-1"></i>View
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @if (!string.IsNullOrEmpty(ticket.Notes))
                            {
                                <div class="alert alert-light border mb-0">
                                    <div class="d-flex">
                                        <i class="bi bi-chat-square-text text-muted me-2"></i>
                                        <div>
                                            <div class="small text-muted mb-1">Notes</div>
                                            <div class="small">@ticket.Notes</div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@functions {
    string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "Paid" => "bg-success",
            "Pending" => "bg-warning",
            "Rejected" => "bg-danger",
            "UnderProcess" => "bg-info text-white",

            _ => "bg-secondary"
        };
    }
}

<style>
    /* Clickable row styling */
    .ticket-row {
        cursor: pointer;
        transition: background-color 0.15s ease;
    }
    
    .ticket-row:hover {
        background-color: rgba(var(--bs-primary-rgb), 0.03) !important;
    }
    
    .ticket-row td:last-child {
        position: relative;
        pointer-events: none;
    }
    
    .ticket-row a {
        pointer-events: auto;
    }

    /* Card styling */
    .card {
        border: 1px solid rgba(0,0,0,0.05);
        border-radius: 0.75rem;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,0.08) !important;
    }

    /* Table styling */
    .table {
        --bs-table-hover-bg: transparent;
    }

    .table > :not(caption) > * > * {
        padding: 1rem 1.25rem;
    }

    /* Badge styling */
    .badge {
        font-weight: 500;
        letter-spacing: 0.3px;
        padding: 0.4em 0.8em;
        border-radius: 0.375rem;
    }

    /* Responsive adjustments */
    @@media (max-width: 767.98px) {
        .card-body {
            padding: 1.25rem;
        }
        
        /* Make mobile cards clickable */
        .card {
            cursor: pointer;
        }
        
        .card .btn {
            pointer-events: auto;
        }
    }
    
    /* Status badge styling */
    .badge {
        font-weight: 500;
        letter-spacing: 0.3px;
        padding: 0.4em 0.8em;
        border-radius: 0.375rem;
        text-transform: capitalize;
    }
    
    /* Remove default link styling */
    .ticket-row a {
        text-decoration: none;
        color: inherit;
    }
</style>

<script>
    // Make rows clickable
    document.addEventListener('DOMContentLoaded', function() {
        // For desktop rows
        document.querySelectorAll('.ticket-row').forEach(row => {
            row.addEventListener('click', function(e) {
                // Don't navigate if clicking on buttons or links
                if (e.target.tagName === 'A' || e.target.closest('a')) {
                    return;
                }
                window.location.href = this.dataset.href;
            });
        });
        
        // For mobile cards
        document.querySelectorAll('.card').forEach(card => {
            const link = card.querySelector('a[href]');
            if (link) {
                card.addEventListener('click', function(e) {
                    // Don't navigate if clicking on buttons or links
                    if (e.target.tagName === 'A' || e.target.closest('a')) {
                        return;
                    }
                    window.location.href = link.href;
                });
            }
        });
    });
</script>